
---
title: Introduction to mrgsolve
output: 
  revealjs::revealjs_presentation:
    transition: fade
---


```{r, include = FALSE}
library(mrgsolve)
library(dplyr)
library(knitr)
opts_chunk$set(comment = '.', fig.height = 5, fig.width = 9)
```

Many pieces fit together to to produce a simulation
=============================

```{r, echo = FALSE, message = FALSE}
mod <- mread_cache("popex", modlib()) %>% 
  update(end = 72, delta = 0.2)
data(exidata)
data <- filter(exidata, ID <=10)
set.seed(1222)
```


Simulate
===============
```{r}
mrgsim(mod)
```



```{r, fig.width = 8, fig.height = 4}
mod %>%
  idata_set(data) %>%
  ev(amt = 100) %>%
  Req(DV) %>%
  mrgsim() %>% 
  plot()
```

A model object
=============================

<div class = "column-left">
<pre class = mypre>
<alrt>mod</alrt> %>%
  idata_set(data) %>%
  ev(amt = 100) %>%
  Req(DV) %>%
  mrgsim() %>%
  plot()
</pre>
</div>


<div class = "column-right">

- All information about the __model__ required
to run the simulation


<alrt>TODO</alrt>:

- Write a model specification file
- Read in that file 

</div>


Introduce an population
=============================

<div class = "column-left">
<pre class = mypre>
mod %>%
  <alrt>idata_set(data)</alrt> %>%
  ev(amt = 100) %>% 
  Req(DV) %>%
  mrgsim() %>%
  plot()
</pre>
</div>

<div class = "column-right">

<alrt>TODO</alrt>:

- Discuss parameters and updating parameters

</div>




Introduce an intervention
=============================

<div class = "column-left">
<pre class = mypre>
mod %>%
  idata_set(data) %>%
  <alrt>ev(amt = 100)</alrt> %>%
  Req(DV) %>%
  mrgsim() %>%
  plot()
</pre>
</div>

<div class = "column-right">

- Bolus doses, infusions doses
- Other interventions

<alrt>TODO</alrt>:

- Use event objects
- Create input `data_sets`

</div>



Customize the simulation
=============================

<div class = "column-left">

<pre class = mypre>
mod %>%
  idata_set(data) %>%
  ev(amt = 100) %>%
  <alrt>Req(DV)</alrt> %>%
  mrgsim() %>%
  plot()
</pre>

</div>

<div class = "column-right">

- Request certain ouputs
- Modify duration of simulation
- Copy inputs into the output
- Skip random effects simulation

<alrt>TODO</alrt>:

- Explore different options for customizing 
your simulation

</div>


Actually do the simulation
=============================

<div class = "column-left">

<pre class = mypre>
mod %>%
  idata_set(data) %>%
  ev(amt = 100) %>%
  Req(DV) %>%
  <alrt>mrgsim()</alrt> %>%
  plot()
</pre>

</div>

<div class = "column-right">

- Most or all configuration items can be passed into `mrgsim`

</div> 


Post-process the simulation
=============================

<div class = "column-left">

<pre class = mypre>
mod %>%
  idata_set(data) %>%
  ev(amt = 100) %>%
  Req(DV) %>%
  mrgsim() %>%
  <alrt>plot()</alrt>
</pre>

</div>



<div class = "column-left">

- `plot`
- `mutate`
- `filter`
- `summarise`
- `as_data_frame`

</div>
